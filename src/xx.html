<!DOCTYPE html>
<html>

<head>
  <title>抽奖大转盘</title>
  <style type="text/css">
    canvas {
      margin: 0 auto;
      display: block;
      border: 1px solid #ccc;
      transform: rotate(-90deg);
    }
  </style>
</head>

<body>
  <canvas
    id="canvas"
    width="400"
    height="400"
  ></canvas>
  <div
    class="spin-button"
    onclick="spin()"
  >Spin</div>

  <script>
    // 具体抽奖逻辑，奖品可以自定义
    var awards = [
      { name: "一等奖", color: "#FF4040" },
      { name: "二等奖", color: "#409EFF" },
      { name: "三等奖", color: "#67C23A" },
      { name: "四等奖", color: "#E6A23C" },
      { name: "五等奖", color: "#909399" },
      { name: "六等奖", color: "#F56C6C" },
      { name: "七等奖", color: "#67C23A" },
      { name: "八等奖", color: "#E6A23C" },
      { name: "九等奖", color: "#909399" },
      { name: "十等奖", color: "#F56C6C" }
    ];
    var canvas = document.getElementById("canvas");
    var ctx = canvas.getContext("2d");
    var startAngle = 0;
    var arc = Math.PI / (awards.length / 2);
    var spinTimeout = null;
    var spinArcStart = 10;
    var spinTime = 0;
    var spinTimeTotal = 0;
    var ctxFont = "bold 18px Arial";
    var ctxAlign = "center";
    var ctxBaseline = "middle";
    var centerX = canvas.width / 2;
    var centerY = canvas.height / 2;
    function draw() {
      drawRouletteWheel();
    }
    function drawRouletteWheel() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.strokeStyle = "#000";
      ctx.lineWidth = 2;
      ctx.font = ctxFont;
      ctx.textAlign = ctxAlign;
      ctx.textBaseline = ctxBaseline;
      for (var i = 0; i < awards.length; i++) {
        var angle = startAngle + i * arc;
        ctx.fillStyle = awards[i].color;
        ctx.beginPath();
        ctx.arc(centerX, centerY, canvas.width / 2 - 30, angle, angle + arc, false);
        ctx.lineTo(centerX, centerY);
        ctx.fill();
        ctx.save();
        ctx.fillStyle = "#fff";
        ctx.translate(centerX + Math.cos(angle + arc / 2) * (canvas.width / 2 - 60), centerY + Math.sin(angle + arc / 2) * (canvas.width / 2 - 60));
        ctx.rotate(angle + arc / 2 + Math.PI / 2);
        var text = awards[i].name;
        ctx.fillText(text, -ctx.measureText(text).width / 2, 0);
        ctx.restore();
      }
      //Arrow
      ctx.fillStyle = "#000";
      ctx.beginPath();
      ctx.moveTo(centerX - 4, centerY - (canvas.width / 2 - 30) - 25);
      ctx.lineTo(centerX + 4, centerY - (canvas.width / 2 - 30) - 25);
      ctx.lineTo(centerX + 4, centerY - (canvas.width / 2 - 30) - 45);
      ctx.lineTo(centerX + 9, centerY - (canvas.width / 2 - 30) - 45);
      ctx.lineTo(centerX + 0, centerY - (canvas.width / 2 - 30) - 60);
      ctx.lineTo(centerX - 9, centerY - (canvas.width / 2 - 30) - 45);
      ctx.lineTo(centerX - 4, centerY - (canvas.width / 2 - 30) - 45);
      ctx.lineTo(centerX - 4, centerY - (canvas.width / 2 - 30) - 25);
      ctx.fill();
    }
    function spin() {
      spinAngleStart = Math.random() * 10 + 10;
      spinTime = 0;
      spinTimeTotal = Math.random() * 3 + 4 * 1000;
      rotateWheel();
    }
    function rotateWheel() {
      spinTime += 30;
      if (spinTime >= spinTimeTotal) {
        stopRotateWheel();
        return;
      }
      var spinAngle = spinAngleStart - easeOut(spinTime, 0, spinAngleStart, spinTimeTotal);
      startAngle += (spinAngle * Math.PI / 180);
      drawRouletteWheel();
      spinTimeout = setTimeout('rotateWheel()', 30);
    }
    function stopRotateWheel() {
      clearTimeout(spinTimeout);
      var degrees = startAngle * 180 / Math.PI + 90;
      var arcd = arc * 180 / Math.PI;
      var index = Math.floor((360 - degrees % 360) / arcd);
      ctx.save();
      ctx.font = ctxFont;
      var text = awards[index].name;
      ctx.fillText(text, centerX, centerY + (canvas.width / 2 - 30) / 2);
      ctx.restore();
    }
    function easeOut(t, b, c, d) {
      var ts = (t /= d) * t;
      var tc = ts * t;
      return b + c * (tc + -3 * ts + 3 * t);
    }
    draw();
  </script>
</body>

</html>